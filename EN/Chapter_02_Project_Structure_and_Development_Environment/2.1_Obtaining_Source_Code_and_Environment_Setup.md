# 2.1 Obtaining Source Code and Environment Setup

> **Model**: claude-opus-4-6 (anthropic/claude-opus-4-6)
> **Generation Date**: 2025-02-17

---

## 2.1.1 Cloning the Repository and Branch Strategy

OpenCode's source code is hosted on GitHub. To begin the source code reading journey in this book, you first need to obtain the source code:

```bash
git clone https://github.com/anthropics/opencode.git
cd opencode
```

OpenCode follows the standard GitHub Flow branching strategy:

- `main` branch: the stable release branch
- Feature branches: branched off from `main`, merged back into `main` via Pull Requests upon completion

It is recommended that after cloning the repository, readers check out a specific Release tag (e.g., `v1.1.x`) to read the source code, avoiding changes during the reading process. This book is written based on version v1.1.56.

## 2.1.2 Introduction to the Bun Runtime and Installation

Open `package.json`, and you will notice a particular field:

```json
{
  "packageManager": "bun@1.3.8"
}
```

OpenCode uses **Bun** as its JavaScript/TypeScript runtime, rather than the more common Node.js.

> **Extended Explanation: What is Bun?**
>
> Bun is a high-performance JavaScript/TypeScript runtime written in the Zig programming language. It integrates the following capabilities into a single tool:
>
> 1. **JavaScript runtime** (similar to Node.js): executes JS/TS code
> 2. **Package manager** (similar to npm/yarn/pnpm): installs and manages dependencies
> 3. **Bundler** (similar to webpack/esbuild): bundles source code into distributable formats
> 4. **Test runner** (similar to Jest/Vitest): runs tests
>
> **Why does OpenCode choose Bun over Node.js?**
>
> - **Native TypeScript support**: Bun can directly run `.ts` files without a compilation step. This means no `tsc` compilation is needed during development, significantly speeding up the development experience.
> - **Fast startup**: Bun's startup time is far lower than Node.js, which is critical for CLI tools -- every time a user executes the `opencode` command, fast startup noticeably improves the experience.
> - **Rich built-in features**: Bun's built-in Shell API (`$` template tag), Glob, file I/O, and other features are widely used throughout the OpenCode source code.
> - **Compatible with the Node.js ecosystem**: Bun is compatible with the vast majority of npm packages, so there are no ecosystem concerns.
>
> Of course, choosing Bun comes with trade-offs -- it is still under rapid iteration, and its Windows support is not as mature as Node.js. However, for a developer-oriented tool like OpenCode, this is a reasonable technical bet.

**Installing Bun**:

```bash
# macOS / Linux
curl -fsSL https://bun.sh/install | bash

# Or via Homebrew
brew install oven-sh/bun/bun
```

Verify the installation:

```bash
bun --version
# Should output 1.3.8 or higher
```

## 2.1.3 Installing Dependencies and First Build

```bash
# Install all dependencies
bun install

# Run in development mode
bun run dev
```

`bun install` reads the `bun.lock` file (Bun's lock file, similar to npm's `package-lock.json`) in the root directory to install exact versions of dependencies.

The project uses **Turborepo** to manage build tasks across sub-packages in the Monorepo. `turbo.json` defines the dependency relationships between tasks:

```json
{
  "tasks": {
    "typecheck": {},
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "opencode#test": {
      "dependsOn": ["^build"],
      "outputs": []
    }
  }
}
```

Key concepts here:

- `^build` means "build all dependent sub-packages first." For example, if `packages/app` depends on `packages/ui`, then `ui` will be built before `app`.
- `outputs: ["dist/**"]` tells Turborepo which files are build artifacts, used for caching -- if the source code hasn't changed, the build is skipped and the cache is used directly.

## 2.1.4 Nix Flake Environment Configuration

The project root contains `flake.nix` and `flake.lock` files, indicating that OpenCode also supports managing the development environment through Nix.

> **Extended Explanation: Nix and Flakes**
>
> Nix is a purely functional package manager. **Nix Flake** is the modern project management approach for Nix. Through the `flake.nix` file, it declares all of a project's dependencies (including system-level tools), ensuring that every developer has an identical development environment.
>
> If you have Nix installed on your machine, you can simply run `nix develop` to enter a shell environment containing all necessary tools, without manually installing Bun or any other tools.
>
> This is not a requirement for using OpenCode -- most readers only need to install Bun.

If you are using Nix:

```bash
# Enter the development environment (automatically installs all required system tools)
nix develop
```
